# tams_phasespace

A ROS catkin package for integration with the PhaseSpace Impulse X2E
motion tracking system.



### Setup and Installation

* You will need [ROS] (http://wiki.ros.org), version Indigo or newer. 
  The software has only been tested using Ubuntu Linux 14.04 LTS
  and 16.04 LTS.  

* You will need the Impulse X2E motion tracking system from 
  [PhaseSpace Inc.](http://phasespace.com/x2e-motion-capture/)
  (unless you only want to replay recorded rosbags).

* You need the 
  [phasespace_msgs] (gogs@git.crossmodal-learning.org:eugen.richter/phasespace_msgs.git) and 
  [phasespace_ros] (gogs@git.crossmodal-learning.org:eugen.richter/phasespace_ros.git) 
  ROS packages.

### Usage

Typical usage is to start the PhaseSpace tracker with one of your
predefined profiles, then start the 
[phasespace_ros](gogs@git.crossmodal-learning.org:eugen.richter/phasespace_ros.git) 
tracking node with the same profile.
  ```
  roslaunch phasespace_ros stream_data.launch arg_owl_profile:=right_hand
  ```

You can then run tools from this package.
Currently, the following nodes and launch configurations are provided:

* ```workspace_visualizer```. This tool subscribes to the PhaseSpace
  ```cameras``` topic and retrieves the position/orientation of the
  active PhaseSpace cameras. It then visualizes the view frustrums of
  the cameras using ROS visualization markers and different color
  schemes. This allows you to check that the intended experiment workspace
  is in fact covered by enough cameras.

  ```
  tams143> roscore &
  tams215> export ROS_MASTER_URI=http://tams143.informatik.uni-hamburg.de:11311
  tams215> roslaunch phasespace_ros stream_data.launch arg_profile:=right_hand
  tams143> roslaunch tams_phasespace workspace_visualizer_demo.launch
  ... select colormap and adjust parameters in rqt_dynamic_reconfigure
  ... select octomap visualization options in rviz
  ```

* ```calibration_visualizer```. This tools subscribes to the PhaseSpace
  ```markers``` topic and compares the measured pairwise distances of
  previously configured markers; for example, markers on the PhaseSpace
  calibration wand. The tracking errors are then visualized in rviz 
  to check and verify that the system is calibrated correctly.
 
* ```stylus_node```. Use our Stylus object to interactively
   specify/select/track 3D poses inside the PhaseSpace workspace.
   The Stylus is visualized as an interactive marker in rviz,
   with control by a combination of keyboard commands and the button
   on the Stylus object.

  ```
  tams215> roslaunch phasespace_ros stream_data.launch arg_owl_profile:=right_hand
  tams143> roslaunch tams_phasespace stylus_demo.launch
  tams143> rostopic echo /phasespace_stylus/command_log
  ```


### Troubleshooting

* In case of trouble, first check the Phasespace web client 
  for status and error messages:
   [Webclient@tams215](http://tams215.informatik.uni-hamburg.de)
 
* Sometimes, initialization of the cameras fails. In this case,
  press the white button on the camera hub to restart the hub
  and reinitialize all cameras.

* Only one owl client can run as the master. If you need multiple
  ```phasespace_ros_node``` instances, make sure to run the first
  one as master, all remaining instances as slaves. This can be
  set via launch arguments to the ```stream_data.launch``` file.

* The PhaseSpace microdriver has (undocumented) debug modes
  that are sometimes entered when pressing the white button
  (on/off) too long (or too short). 

* The microdriver also sometimes behaves strange when battery
  is running low. Recharge before using again.

* At the moment, the owl server machine runs Ubuntu 16.04 with
  ROS Kinetic, while other machines on the network (e.g. obelix)
  still run 14.04 and Indigo. While mixing versions mostly works,
  some messages were changed between versions and have different
  MD5 checksums. This includes the ```visualization_msgs/Marker```
  generated by the ```viz_proxy``` node. If necessary, run the
  ```phasespace_ros_node``` on tams215 and the tf and viz proxies
  on a 14.04 machine.
  (It is also possible to edit the MD5 message checksums by hand,
   but that is not generally recommended.)


